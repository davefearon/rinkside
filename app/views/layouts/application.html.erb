<!doctype html>

<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>Rinkside</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">

  <script src="/javascripts/libs/modernizr-1.6.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery-1.4.2.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/script.js"></script>

  <%= stylesheet_link_tag :all %>
  <% #= javascript_include_tag :defaults %>
  <%= csrf_meta_tag %>
</head>

<body>
<script src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script>
var lat;
var lon;
findLocation();
function findLocation(){
	if( navigator.geolocation )
	{
		navigator.geolocation.getCurrentPosition( successCallback, errorCallback );
	}
	else
	{
		// alert the user of no location
	}
}

function successCallback( position )
{
	lat = position.coords.latitude;
	lon = position.coords.longitude;
    //console.debug("latitude: " + lat + ", longitude: " + lon);
    map_initialize();
}

function errorCallback()
{
	//do something with erorr
}

var map;
var marker;
var infoWindow;
var address;
var url;
var info;

function map_initialize()
{
	var myOptions = { zoom: 15, mapTypeId: google.maps.MapTypeId.ROADMAP };
	map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

	infoWindow = new google.maps.InfoWindow();

	var geo = new google.maps.Geocoder();

    address = 'Ottawa, Ontario, Canada';

    if(lat == null || lon == null)
    {
        address = 'Ottawa, Ontario, Canada';
    }
    else
    {
        address = lat + ", " + lon;
    }

    geo.geocode({'address' : address }, function(results, status) {
        map.setCenter(results[0].geometry.location);
    });

	info = "<div style='color:#000000;font-size:14px;'>You Live Here!</div>";

	makemarker(info, address);
};

function makemarker( info, address )
{
	var geocoder = new google.maps.Geocoder();

	geocoder.geocode({ 'address': address }, function(results, status) {
		if( status == google.maps.GeocoderStatus.OK )
		{
			marker = new google.maps.Marker({
				map:map,
				clickable: true,
				position: results[0].geometry.location
			});

			makeInfoWindow(marker, info);
		}
		else
		{
			//not success
		}
	});
};

function makeInfoWindow(marker, info)
{
	google.maps.event.addListener(marker, "click", function(event) {
		infoWindow.setContent(info);
		infoWindow.open(map, marker);
	});
};

/* END OF MAPS
=============================================================================================*/
</script>
<script type="text/javascript">
    $(document).ready( function()
    {
        //map_initialize('rinks/map/all');
    });
</script>

<%= yield %>

 <!--[if lt IE 7 ]>
    <script src="/javascripts/libs/dd_belatedpng.js"></script>
    <script> DD_belatedPNG.fix('img, .png_bg'); </script>
 <![endif]-->

  <!-- TODO: change UA-XXXXX-X -->
  <script>
   var _gaq = [['_setAccount', 'UA-XXXXX-X'], ['_trackPageview']];
   (function(d, t) {
    var g = d.createElement(t),
        s = d.getElementsByTagName(t)[0];
    g.async = true;
    g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g, s);
   })(document, 'script');
  </script>

</body>
</html>